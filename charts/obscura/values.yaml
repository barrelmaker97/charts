---
obscura:
  logLevel: info
  # Connection string for the PostgreSQL database.
  # If empty, it will be generated using the postgresql subchart values.
  databaseUrl: ""

  # Global time-to-live for messages and attachments in days
  ttlDays: 30

  # Server configuration
  server:
    host: "0.0.0.0"
    port: 3000
    mgmtPort: 9090
    shutdownTimeoutSecs: 5
    # Comma-separated list of CIDRs to trust for X-Forwarded-For IP extraction
    trustedProxies: "10.0.0.0/8,172.16.0.0/12,192.168.0.0/16,127.0.0.1/32"

  # Auth configuration
  auth:
    # Secret key for JWT generation/validation.
    # WARNING: Must be changed for production!
    jwtSecret: "change_me_to_a_secure_random_string"
    accessTokenTtlSecs: 900
    refreshTokenTtlDays: 30

  # Rate limit configuration
  rateLimit:
    perSecond: 10
    burst: 20
    authPerSecond: 1
    authBurst: 3

  # Health check configuration
  health:
    dbTimeoutMs: 2000
    storageTimeoutMs: 2000
    pubsubTimeoutMs: 2000

  # Messaging configuration
  messaging:
    maxInboxSize: 1000
    cleanupIntervalSecs: 300
    batchLimit: 50
    preKeyRefillThreshold: 20
    maxPreKeys: 100

  # Notification configuration
  notifications:
    gcIntervalSecs: 60
    globalChannelCapacity: 1024
    userChannelCapacity: 64

  # PubSub configuration
  pubsub:
    # Connection string for the Valkey/Redis database.
    # If empty, it will be generated using the valkey subchart values.
    url: ""
    minBackoffSecs: 1
    maxBackoffSecs: 30

  # Websocket configuration
  websocket:
    outboundBufferSize: 32
    ackBufferSize: 100
    ackBatchSize: 50
    ackFlushIntervalMs: 500

  # Storage / Attachment configuration
  storage:
    bucket: "obscura-attachments"
    region: "us-east-1"
    # If empty and minio.enabled is true, it will be generated.
    endpoint: ""
    # Access and Secret keys. If empty and minio.enabled is true, minio defaults will be used.
    accessKey: ""
    secretKey: ""
    forcePathStyle: true
    maxSizeBytes: 52428800
    cleanupIntervalSecs: 3600
    cleanupBatchSize: 100

  # Telemetry configuration
  telemetry:
    # OTLP Endpoint for traces and metrics (e.g. http://otel-collector:4317)
    # If empty, OTLP export is disabled (logs only).
    otlpEndpoint: ""
    # Log format (text or json)
    logFormat: "text"
    # Trace sampling ratio (0.0 to 1.0)
    traceSamplingRatio: 1.0
    metricsExportIntervalSecs: 60
    exportTimeoutSecs: 10

postgresql:
  enabled: true
  auth:
    username: obscura
    # WARNING: Must be changed for production!
    password: obscura_password
    database: obscura_db

minio:
  enabled: true
  mode: standalone
  replicas: 1
  serviceAccount:
    create: false
  rootUser: obscura
  # WARNING: Must be changed for production!
  rootPassword: obscura_password
  image:
    tag: RELEASE.2025-09-07T16-13-09Z
  persistence:
    enabled: false
  # The MinIO subchart defaults to 16Gi memory requests, which exceeds
  # most namespace quotas. We override it here to a sane default.
  resources:
    requests:
      memory: 256Mi

valkey:
  enabled: true
  architecture: standalone
  auth:
    enabled: true
    # WARNING: Must be changed for production!
    password: obscura_password
    aclUsers:
      default:
        password: obscura_password
        permissions: "+@all ~* &*"
  persistence:
    enabled: false

replicaCount: 1

image:
  repository: ghcr.io/barrelmaker97/obscura-server
  pullPolicy: IfNotPresent
  # Overrides the image tag whose default is the chart appVersion.
  tag: ""

imagePullSecrets: []
nameOverride: ""
fullnameOverride: ""

serviceAccount:
  # Specifies whether a service account should be created
  create: true
  # Annotations to add to the service account
  annotations: {}
  # The name of the service account to use.
  # If not set and create is true, a name is generated using the fullname template
  name: ""

podAnnotations: {}

podSecurityContext: {}
  # fsGroup: 10001
  # runAsGroup: 10001
  # runAsUser: 10001
  # runAsNonRoot: true
  # seccompProfile:
  #   type: RuntimeDefault

securityContext: {}
  # allowPrivilegeEscalation: false
  # capabilities:
  #   drop:
  #     - ALL

service:
  type: ClusterIP
  port: 80

ingress:
  enabled: false
  className: ""
  annotations: {}
    # kubernetes.io/ingress.class: nginx
    # kubernetes.io/tls-acme: "true"
    # nginx.ingress.kubernetes.io/proxy-read-timeout: "3600"
    # nginx.ingress.kubernetes.io/proxy-send-timeout: "3600"
    # nginx.ingress.kubernetes.io/websocket-services: "obscura"
  hosts:
    - host: obscura.local
      paths:
        - path: /
          pathType: ImplementationSpecific
  tls: []
  #  - secretName: obscura-tls
  #    hosts:
  #      - obscura.local

resources: {}
  # requests:
  #   cpu: 100m
  #   memory: 128Mi
  # limits:
  #   cpu: 200m
  #   memory: 256Mi

autoscaling:
  enabled: false
  minReplicas: 1
  maxReplicas: 100
  targetCPUUtilizationPercentage: 80
  # targetMemoryUtilizationPercentage: 80

nodeSelector: {}

tolerations: []

affinity: {}
